<h1>My expenses</h1>
<br>

<h2>Today:</h2>
<br>

<div class="row">
  <!-- % @userstransactions.each do |transaction| %> -->
  <% @userstransactions.where(created_at: (Time.now.midnight)..(Time.now.midnight + 1.day)).find_each do |transaction| %>
  <div class="col-md-3">
    <div align="center">
    <%= transaction.price %>£<br>
    <%= image_tag(transaction.icon.image.url(:medium)) %><br></div>
  </div>
    <% end %>
  </div>

  <h2>This week:</h2>
<br>

  <% sum = 0; sums = {}; images = {} %>
<% @userstransactions.select("transactions.*", "icons.*").joins(:icon).where(created_at: (Time.now.midnight - 7.day)..(Time.now.midnight + 1.day)).order("transactions.icon_id").find_all do |transaction| %>

  <% icon_type = transaction.icon.title;
  if sums[icon_type] == nil
    sums[icon_type] = transaction.price
  else
    sums[icon_type] += transaction.price
  end
images[icon_type] = transaction.icon.image.url(:medium) %>

  <% end %>

<div class="col-md-3">
    <div align="center">
    <% sums.each do |key, array| %>
      <%= array %>£<br>
      <%= image_tag(images[key]) %><br>
    <% end %>
    </div>
  </div>
